---
title: "final_data"
author: "Chris Hunter"
date: "2024-08-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(stringr)
library(janitor)
library(lubridate)

dev.off()
us_i <- clean_names(read_delim("infections/data/us_confirmed.csv"))
us_d <- clean_names(read_delim("infections/data/us_deaths.csv"))

#vax <- read_delim("vax/us_state_vaccinations.csv")
ld <-clean_names(read_delim("lockdown/countryLockdowndates.csv"))

```



#### 1. What are the trends in daily new cases and deaths globally and in specific regions?
compare monthly case totals in 2022 for select states
```{r}


get_new_cases_by_month <- function(year) {
  # month scale is absolute from Jan 2020. This gives each month a unique id so
  # we can aggregate year over year data
  add_months <- 12 * (as.numeric(year) - 2020)

  # A random list of US states
  states <- c("Washington",
              "California",
              "Colorado",
              "Arizona",
              "Ohio",
              "Alabama",
              "Missouri",
              "South Dakota",
              "New York",
              "Texas",
              "Florida",
              "Kentucky" )

  # grab this year's data for the selected states
  this_year <- us_i %>%
    filter(province_state %in% states) %>%
    filter(str_detect(date, year))

  # we'll add each month to this empty data frame in the loop below
  yearly_data <- data.frame()

  # calculate aggregate new cases per month for each state, and add to the
  # yearly data
  for(state in states) {
    this_state_by_month <- this_year %>%
      filter(province_state == state) %>%
      group_by(admin2) %>%
      mutate(new_cases=case - lag(case)) %>%
      drop_na(new_cases) %>%
      group_by(month = month(date) + add_months) %>%
      summarize(new_monthly_cases=sum(new_cases))

    yearly_data = rbind(yearly_data, this_state_by_month %>% mutate(state=state))
  }

  return(yearly_data)
}

# graph data for a specific year
plot_new_cases_by_month <- function(graph_data, title) {
  print(graph_data %>%
    ggplot(aes(x=month,y=new_monthly_cases/1000, color=factor(state))) +
    geom_line() +
    geom_point() +
    labs(x="month", y="Cases per month (x 1000)", color="US State") +
    ggtitle(title)
  )
}

# get data for each year
us_new_cases_2020 <- get_new_cases_by_month('2020')
us_new_cases_2021 <- get_new_cases_by_month('2021')
us_new_cases_2022 <- get_new_cases_by_month('2022')

# make yearly graphs
plot_new_cases_by_month(us_new_cases_2020, "New Cases: 2020")
plot_new_cases_by_month(us_new_cases_2021, "New Cases: 2021")
plot_new_cases_by_month(us_new_cases_2022, "New Cases: 2022 (Jan - April)")
```

#### 2. How do different countries compare in terms of COVID-19 cases and deaths?


#### 3. What is the relationship between public health measures (e.g., lockdowns) and the trends in COVID-19 cases?
```{r}
ld_us <- lockdown %>% 
us_new_cases_all_years <- rbind(us_new_cases_2020, us_new_cases_2021, us_new_cases_2022)
plot_new_cases_by_month(new_cases_all_years, "New cases by month: 01/2020 - 04/2022")
```

#### 4. How has the pandemic affected different age groups and genders?

#### 5. What is the impact of vaccination on the spread of COVID-19?
   - plot vaccination rate vs. infection rate
